NOME
Auth Contract â€” SaaS Multi-Tenant (Oficial)

OBJETIVO
Definir regras imutÃ¡veis de autenticaÃ§Ã£o entre:
- Frontend
- Backend
- SaaS-Admin
- Tenant-Admin

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1ï¸âƒ£ FONTE DE AUTENTICAÃ‡ÃƒO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ” Fonte Ãºnica de autenticaÃ§Ã£o:
COOKIE HTTP-ONLY

ğŸš« Proibido:
- JWT no localStorage
- Token manual no header
- Auth hÃ­brida

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2ï¸âƒ£ FLUXO DE LOGIN
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. UsuÃ¡rio envia credenciais
2. Backend valida
3. Backend:
   - Gera token
   - Salva sessÃ£o (DB ou memÃ³ria)
   - Emite cookie HTTP-only
4. Frontend NÃƒO recebe token em JSON
5. NavegaÃ§Ã£o liberada

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
3ï¸âƒ£ FLUXO DE SESSÃƒO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Endpoint oficial:
GET /api/v1/auth/session

Responsabilidades:
- Ler cookie
- Validar sessÃ£o
- Retornar:
  - authenticated: true/false
  - role
  - tenantId (quando aplicÃ¡vel)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
4ï¸âƒ£ FLUXO DE REFRESH
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Endpoint:
POST /api/v1/auth/refresh

Regras:
- Cookie Ã© enviado automaticamente
- Novo cookie Ã© emitido
- Frontend nÃ£o percebe

ğŸš« Nunca:
- ForÃ§ar refresh manual no frontend
- Loop infinito de refresh

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
5ï¸âƒ£ MULTI-CONTEXTO (SAAS x TENANT)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

- SaaS-Admin e Tenant-Admin compartilham:
  - Mesmo contrato de cookie
  - Mesmo mecanismo de sessÃ£o

DiferenÃ§a:
- Role
- TenantId

Erro padrÃ£o:
"Invalid or expired SaaS Admin token"
â†’ SEMPRE indica cookie ausente ou invÃ¡lido

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
6ï¸âƒ£ LOGOUT
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

- Backend remove cookie
- Backend invalida sessÃ£o
- Frontend apenas redireciona

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
7ï¸âƒ£ REGRAS DE OURO
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ” Auth nÃ£o depende de mÃ³dulo
âœ” Auth nÃ£o depende de sprint
âœ” Auth vem ANTES de qualquer feature
âœ” Se login volta pra tela â†’ cookie falhou

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
STATUS
Este contrato NÃƒO deve ser alterado sem revisÃ£o arquitetural.
